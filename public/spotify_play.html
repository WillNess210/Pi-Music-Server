<!DOCTYPE html>
<html>
<head>
  <title>Spotify Web Playback SDK Quick Start Tutorial</title>
</head>
<body>
  <h1>Spotify Web Playback SDK Quick Start Tutorial</h1>
  <h2>Open your console log: <code>View > Developer > JavaScript Console</code></h2>

  <script src="https://sdk.scdn.co/spotify-player.js"></script>
  <script>
    window.onSpotifyWebPlaybackSDKReady = () => {
        const param = window.location.hash.substr(1);
        const token = param.split("~")[0];
        const song_uri = param.split("~")[1];
        console.log('token: ' + token);

        const play = ({
            spotify_uri,
            playerInstance: {
                _options: {
                    getOAuthToken,
                    id
                }
            }
        }) => {
            getOAuthToken(token => {
                fetch(`https://api.spotify.com/v1/me/player/play?device_id=${id}`, {
                method: 'PUT',
                body: JSON.stringify({ uris: [song_uri] }),
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                });
            });
        };

        play({
            playerInstance: new Spotify.Player({ name: "pi-music-server", getOAuthToken: callback => {callback(token)}}),
            spotify_uri: 'spotify:track:3xaugmCyXrVkrDTXbFkMW3',
        });
    };
  </script>
</body>
</html>